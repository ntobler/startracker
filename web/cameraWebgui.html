<!DOCTYPE html>
<html>

<head>
    <title>WebSocket Image Display</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <style>
        #image {
            position: fixed;
            display: none;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            object-fit: contain;
            image-rendering: pixelated;
        }

        #canvas {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        #camera-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: black;
            color: red;
            font-family: 'Courier', monospace;
            font-size: 2em;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            background: repeating-linear-gradient(-45deg,
                    transparent,
                    transparent 0.1em,
                    #f004 0.1em,
                    #f004 0.2em);
            user-select: none;
        }
    </style>
</head>

<body>
    <div id="app">
        <div id="camera-overlay">No image captured</div>
        <img id="image" src="" alt="Image">
        <canvas id="canvas" width="100" height="100"></canvas>
        <div id="view"><a href="./axisAlign.html">Axis Align View</a></div>
        <div id="footerBar">
            <div>Exposure <input type="number" step="1" v-model.number="camera_settings.exposure_ms"
                    @change="setSettings" style="width: 4em" /> ms</div>
            <div>Gain <input type="number" v-model.number="camera_settings.analog_gain" @change="setSettings" /></div>
            <div>Digital gain
                <select v-model.number="camera_settings.digital_gain" @change="setSettings">
                    <option>1</option>
                    <option>2</option>
                    <option>4</option>
                </select>
            </div>
            <div>Binning
                <select v-model.number="camera_settings.binning" @change="setSettings">
                    <option>1</option>
                    <option>2</option>
                    <option>4</option>
                    <option>8</option>
                </select>
            </div>
            <div>
                Capture
                <button type="button" @click="capture('single')">Single</button>
                <button type="button" @click="capture('continuous')">Continuous</button>
                <button type="button" @click="capture('stop')">Stop</button>
                <button type="button" @click="capture('darkframe')">Darkframe</button>
            </div>
            <div>
                Pattern
                <input type="number" value="13" v-model.number="intrinsic_calibrator.pattern_width"
                    @change="setSettings" size="0" /> x
                <input type="number" value="9" v-model.number="intrinsic_calibrator.pattern_height"
                    @change="setSettings" size="1" /> @
                <input type="number" value="40" v-model.number="intrinsic_calibrator.pattern_size" @change="setSettings"
                    size="1" /> mm
                <button type="button"
                    onclick="window.open('api/calibration_pattern', '_blank'); return false;">Open</button>
            </div>
            <div>
                Calibration
                <button type="button" @click="putCalibrationImage">Put {{ intrinsic_calibrator.index > 0 ?
                    intrinsic_calibrator.index : ""}}</button>
                <button type="button" @click="resetCalibration">Reset</button>
                <button type="button" @click="calibrate">Calibrate</button>
                <button type="button"
                    onclick="window.open('api/calibration_result', '_blank'); return false;">Result</button>
            </div>
            <div>
                Display
                <button type="button" @click="toggleBrightness()">Brightness {{ brightness }}x</button>
                <button type="button" @click="toggleOverlay()" id="overlay">Attitude</button>
            </div>
            <div v_if="attitude != {}">Min matches <input type="number" value="40" v-model.number="attitude.min_matches"
                    @change="setSettings" size="1" /></div>
            <div v_if="attitude != {}">Pixel tolerance <input type="number" value="40"
                    v-model.number="attitude.pixel_tolerance" @change="setSettings" size="1" /></div>
            <div v_if="attitude != {}">Timeout (s) <input type="number" value="40"
                    v-model.number="attitude.timeout_secs" @change="setSettings" size="1" /></div>
            <div v_if="attitude != {}">
                Tracked: {{stream.n_matches}} Times: {{stream.pre_processing_time}}ms, {{stream.processing_time}}ms {{stream.post_processing_time}}ms
            </div>
        </div>
    </div>
    <script type="module">
        import { createApp } from './vue.esm-browser.prod.min.js'
        import CameraWebgui from './cameraWebgui.js'
        createApp(CameraWebgui).mount('#app')
    </script>
</body>

</html>
